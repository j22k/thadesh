{% extends "base.html" %}
{% block extra_css %}
<!-- Link to the external CSS file -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}
{% block content %}
<div class="home-container">
    <div class="hero-section">
        <div class="logo-large">T</div>
        
        <h1 class="hero-title" id="heroTitle">Thadhesh</h1>
        
        <p class="hero-subtitle" id="heroSubtitle">Your voice, Their Actions</p>
        
        <p class="hero-description" id="heroDescription">
            Your AI-powered assistant for Kerala Local Self-Government Department services. Get instant help with 
            building permits, property tax, panchayat services, municipality procedures, and compliance with 
            Kerala Building Rules - all based on official legal documents and acts.
        </p>
        
        <div class="hero-buttons">
            <a href="/chat" class="btn-primary" id="getStartedBtn">
                <i class="fas fa-comment-dots"></i>
                <span>Get Started</span>
                <i class="fas fa-arrow-right"></i>
            </a>
            <a href="#" class="btn-secondary" id="demoBtn">
                <i class="fas fa-play"></i>
                <span>Watch Demo Video</span>
            </a>
            <a href="/login" class="btn-tertiary" id="loginBtn">
                <i class="fas fa-user"></i>
                <span>Login</span>
            </a>
        </div>
        
        <div class="services-section">
            <h3 class="services-title" id="servicesTitle">Popular Services</h3>
            
            <div class="services-grid" id="servicesGrid">
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Building permit application process" data-ml="‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ü‡¥®‡¥ø‡µº‡¥Æ‡µç‡¥Æ‡¥æ‡¥£ ‡¥Ö‡¥®‡µÅ‡¥Æ‡¥§‡¥ø ‡¥Ö‡¥™‡µá‡¥ï‡µç‡¥∑‡¥æ ‡¥™‡µç‡¥∞‡¥ï‡µç‡¥∞‡¥ø‡¥Ø">Building permit application process</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Property tax payment procedures" data-ml="‡¥∏‡µç‡¥µ‡¥§‡µç‡¥§‡µç ‡¥®‡¥ø‡¥ï‡µÅ‡¥§‡¥ø ‡¥Ö‡¥ü‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µΩ ‡¥®‡¥ü‡¥™‡¥ü‡¥ø‡¥ï‡µç‡¥∞‡¥Æ‡¥ô‡µç‡¥ô‡µæ">Property tax payment procedures</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Panchayat tax assessment queries" data-ml="‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç ‡¥®‡¥ø‡¥ï‡µÅ‡¥§‡¥ø ‡¥®‡¥ø‡µº‡¥£‡µç‡¥£‡¥Ø ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥ô‡µç‡¥ô‡µæ">Panchayat tax assessment queries</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Municipality building rules compliance" data-ml="‡¥Æ‡µÅ‡¥®‡¥ø‡¥∏‡¥ø‡¥™‡µç‡¥™‡¥æ‡¥≤‡¥ø‡¥±‡µç‡¥±‡¥ø ‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ü ‡¥®‡¥ø‡¥Ø‡¥Æ ‡¥Ö‡¥®‡µÅ‡¥∏‡¥∞‡¥£‡¥Ç">Municipality building rules compliance</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Zoning regulations and approvals" data-ml="‡¥∏‡µã‡¥£‡¥ø‡¥Ç‡¥ó‡µç ‡¥®‡¥ø‡¥Ø‡¥®‡µç‡¥§‡µç‡¥∞‡¥£‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç ‡¥Ö‡¥®‡µÅ‡¥Æ‡¥§‡¥ø‡¥ï‡¥≥‡µÅ‡¥Ç">Zoning regulations and approvals</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Construction permit documentation" data-ml="‡¥®‡¥ø‡µº‡¥Æ‡µç‡¥Æ‡¥æ‡¥£ ‡¥Ö‡¥®‡µÅ‡¥Æ‡¥§‡¥ø ‡¥°‡µã‡¥ï‡µç‡¥Ø‡µÅ‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µá‡¥∑‡µª">Construction permit documentation</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Local governance procedures" data-ml="‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï ‡¥≠‡¥∞‡¥£ ‡¥®‡¥ü‡¥™‡¥ü‡¥ø‡¥ï‡µç‡¥∞‡¥Æ‡¥ô‡µç‡¥ô‡µæ">Local governance procedures</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
                <div class="service-card" onclick="window.location.href='/chat'">
                    <p class="service-text" data-en="Building plan approval status" data-ml="‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ü ‡¥™‡µç‡¥≤‡¥æ‡µª ‡¥Ö‡¥®‡µÅ‡¥Æ‡¥§‡¥ø ‡¥®‡¥ø‡¥≤">Building plan approval status</p>
                    <i class="fas fa-arrow-right service-arrow"></i>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Language content for home page
const homePageContent = {
    english: {
        heroSubtitle: "Your voice, Their Actions",
        heroDescription: "Your AI-powered assistant for Kerala Local Self-Government Department services. Get instant help with building permits, property tax, panchayat services, municipality procedures, and compliance with Kerala Building Rules - all based on official legal documents and acts.",
        getStartedBtn: "Get Started",
        demoBtn: "Watch Demo Video",
        loginBtn: "Login",
        servicesTitle: "Popular Services"
    },
    malayalam: {
        heroSubtitle: "‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∂‡¥¨‡µç‡¥¶‡¥Ç, ‡¥Ö‡¥µ‡¥∞‡µÅ‡¥ü‡µÜ ‡¥™‡µç‡¥∞‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥ô‡µç‡¥ô‡µæ",
        heroDescription: "‡¥ï‡µá‡¥∞‡¥≥ ‡¥≤‡µã‡¥ï‡µç‡¥ï‡µΩ ‡¥∏‡µÜ‡µΩ‡¥´‡µç ‡¥ó‡¥µ‡µ∫‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µç ‡¥°‡¥ø‡¥™‡µç‡¥™‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç‚Äå‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µç ‡¥∏‡µá‡¥µ‡¥®‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥≥‡µç‡¥≥ ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ AI-‡¥Ö‡¥ß‡¥ø‡¥∑‡µç‡¥†‡¥ø‡¥§ ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø. ‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ü ‡¥Ö‡¥®‡µÅ‡¥Æ‡¥§‡¥ø‡¥ï‡µæ, ‡¥∏‡µç‡¥µ‡¥§‡µç‡¥§‡µç ‡¥®‡¥ø‡¥ï‡µÅ‡¥§‡¥ø, ‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç ‡¥∏‡µá‡¥µ‡¥®‡¥ô‡µç‡¥ô‡µæ, ‡¥Æ‡µÅ‡¥®‡¥ø‡¥∏‡¥ø‡¥™‡µç‡¥™‡¥æ‡¥≤‡¥ø‡¥±‡µç‡¥±‡¥ø ‡¥®‡¥ü‡¥™‡¥ü‡¥ø‡¥ï‡µç‡¥∞‡¥Æ‡¥ô‡µç‡¥ô‡µæ, ‡¥ï‡µá‡¥∞‡¥≥ ‡¥¨‡¥ø‡µΩ‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥±‡µÇ‡µæ‡¥∏‡µç ‡¥Ö‡¥®‡µÅ‡¥∏‡¥∞‡¥£‡¥Ç ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ‡¥Ø‡¥ø‡µΩ ‡¥§‡µΩ‡¥ï‡µç‡¥∑‡¥£ ‡¥∏‡¥π‡¥æ‡¥Ø‡¥Ç ‡¥®‡µá‡¥ü‡µÅ‡¥ï - ‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç ‡¥î‡¥¶‡µç‡¥Ø‡µã‡¥ó‡¥ø‡¥ï ‡¥®‡¥ø‡¥Ø‡¥Æ ‡¥∞‡µá‡¥ñ‡¥ï‡¥≥‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥®‡¥ø‡¥Ø‡¥Æ‡¥ô‡µç‡¥ô‡¥≥‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥Ö‡¥ü‡¥ø‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡¥ø.",
        getStartedBtn: "‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï",
        demoBtn: "‡¥°‡µÜ‡¥Æ‡µã ‡¥µ‡µÄ‡¥°‡¥ø‡¥Ø‡µã ‡¥ï‡¥æ‡¥£‡µÅ‡¥ï",
        loginBtn: "‡¥≤‡µã‡¥ó‡¥ø‡µª",
        servicesTitle: "‡¥ú‡¥®‡¥™‡µç‡¥∞‡¥ø‡¥Ø ‡¥∏‡µá‡¥µ‡¥®‡¥ô‡µç‡¥ô‡µæ"
    }
};

// Function to update home page content based on language
function updateHomePageLanguage(language = 'english') {
    console.log('üè† Updating home page language to:', language);
    
    const content = homePageContent[language];
    if (!content) {
        console.error('‚ùå Language content not found for:', language);
        return;
    }
    
    try {
        // Update hero section
        const heroSubtitle = document.getElementById('heroSubtitle');
        const heroDescription = document.getElementById('heroDescription');
        const servicesTitle = document.getElementById('servicesTitle');
        
        if (heroSubtitle) {
            heroSubtitle.textContent = content.heroSubtitle;
            console.log('‚úÖ Updated hero subtitle');
        }
        
        if (heroDescription) {
            heroDescription.textContent = content.heroDescription;
            console.log('‚úÖ Updated hero description');
        }
        
        if (servicesTitle) {
            servicesTitle.textContent = content.servicesTitle;
            console.log('‚úÖ Updated services title');
        }
        
        // Update buttons
        const getStartedBtn = document.querySelector('#getStartedBtn span');
        const demoBtn = document.querySelector('#demoBtn span');
        const loginBtn = document.querySelector('#loginBtn span');
        
        if (getStartedBtn) {
            getStartedBtn.textContent = content.getStartedBtn;
            console.log('‚úÖ Updated get started button');
        }
        
        if (demoBtn) {
            demoBtn.textContent = content.demoBtn;
            console.log('‚úÖ Updated demo button');
        }
        
        if (loginBtn) {
            loginBtn.textContent = content.loginBtn;
            console.log('‚úÖ Updated login button');
        }
        
        // Update service cards using data attributes
        const serviceTexts = document.querySelectorAll('.service-text');
        console.log('üîÑ Found', serviceTexts.length, 'service cards to update');
        
        serviceTexts.forEach((element, index) => {
            const englishText = element.getAttribute('data-en');
            const malayalamText = element.getAttribute('data-ml');
            
            if (language === 'malayalam' && malayalamText) {
                element.textContent = malayalamText;
                console.log(`‚úÖ Updated service card ${index + 1} to Malayalam`);
            } else if (englishText) {
                element.textContent = englishText;
                console.log(`‚úÖ Updated service card ${index + 1} to English`);
            }
        });
        
        console.log('üéâ Home page language update completed successfully');
        
    } catch (error) {
        console.error('‚ùå Error updating home page language:', error);
    }
}

// Function to get current language from base template
function getCurrentLanguage() {
    // Try multiple ways to get the current language
    if (typeof window.currentSiteLanguage !== 'undefined') {
        return window.currentSiteLanguage;
    }
    
    try {
        const stored = localStorage.getItem('thadhesh_language');
        if (stored) return stored;
    } catch (e) {
        console.warn('Could not access localStorage');
    }
    
    return 'english'; // default fallback
}

// Enhanced language monitoring
function startLanguageMonitoring() {
    let lastLanguage = getCurrentLanguage();
    console.log('üîç Starting language monitoring, initial language:', lastLanguage);
    
    // Update immediately
    updateHomePageLanguage(lastLanguage);
    
    // Monitor for changes every 200ms
    const monitorInterval = setInterval(() => {
        const currentLang = getCurrentLanguage();
        
        if (currentLang !== lastLanguage) {
            console.log('üîÑ Language change detected:', lastLanguage, '->', currentLang);
            updateHomePageLanguage(currentLang);
            lastLanguage = currentLang;
        }
    }, 200);
    
    // Listen for clicks on language toggle
    document.addEventListener('click', function(e) {
        const clickedToggle = e.target.closest('#languageToggle, #mobileLanguageToggle');
        if (clickedToggle) {
            console.log('üñ±Ô∏è Language toggle clicked on homepage');
            
            // Wait a bit for base template to update, then check language
            setTimeout(() => {
                const newLang = getCurrentLanguage();
                console.log('üîÑ Post-click language check:', newLang);
                updateHomePageLanguage(newLang);
            }, 300);
        }
    });
}

// Debug functions for testing
window.testLanguageToggle = function() {
    console.log('üß™ Testing language toggle...');
    const currentLang = getCurrentLanguage();
    const newLang = currentLang === 'english' ? 'malayalam' : 'english';
    console.log('üîÑ Manually switching from', currentLang, 'to', newLang);
    updateHomePageLanguage(newLang);
};

window.forceLanguageUpdate = function(lang = 'malayalam') {
    console.log('üîß Force updating to:', lang);
    updateHomePageLanguage(lang);
};

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    console.log('üè† Homepage DOM loaded, initializing language system...');
    
    // Wait a moment for base template to initialize
    setTimeout(() => {
        startLanguageMonitoring();
    }, 500);
});

// Also try to initialize immediately if DOM is already loaded
if (document.readyState !== 'loading') {
    console.log('üè† DOM already loaded, initializing immediately...');
    setTimeout(startLanguageMonitoring, 100);
}
</script>
{% endblock %}